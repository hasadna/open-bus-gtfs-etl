- name: gtfs-etl
  schedule_interval: "@daily"
  description: |
    Load GTFS data to DB
  tasks:
    - id: download
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: download
    - id: analyze
      depends_on:
        - download
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: analyze
        kwargs:
          date: {}
    - id: load-to-db
      depends_on:
        - analyze
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: load_to_db
        kwargs:
          date: {}
    - id: cleanup-dated-paths
      depends_on:
        - analyze
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: cleanup_dated_paths
        kwargs:
          num_days_keep: {default: 10}
          num_weeklies_keep: {default: 10}
