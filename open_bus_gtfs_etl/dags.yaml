- name: gtfs-etl
  schedule_interval: "@daily"
  description: |
    Load GTFS data to DB
  tasks:
    - id: download
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: download
        kwargs:
          date: {}
          analyzed: {}
          workdir: {}
    - id: extract
      depends_on:
        - download
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: extract
        kwargs:
          date: {}
          workdir: {}
    - id: analyze
      depends_on:
        - extract
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: analyze
        kwargs:
          date: {}
          workdir: {}
    - id: load-to-db
      depends_on:
        - analyze
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: load_to_db
        kwargs:
          workdir: {}
#    - id: stop-times-load-to-db
#      depends_on:
#        - load-to-db
#      config:
#        type: cli
#        module: open_bus_gtfs_etl.stop_times.cli
#        function: load_to_db
#        kwargs:
#          date: {}
#          limit: {}
#          no_count: {}
    - id: cleanup-dated-paths
      depends_on:
        - analyze
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: cleanup_dated_paths
        kwargs:
          num_days_keep: {default: 10}
          num_weeklies_keep: {default: 10}
