- name: gtfs-etl-full-process
  schedule_interval: "@hourly"
  description: |
    Idempotent scheduled task which ensures GTFS data integrity for last 30 days
  docs:
    desc: |
      Runs hourly, downloads the daily GTFS data from MOT if not downloaded yet.
      Downloaded data is also made publically available in the following format:
      `https://openbus-stride-public.s3.eu-west-1.amazonaws.com/gtfs_archive/year/month/dat/filename`,
      for example: https://openbus-stride-public.s3.eu-west-1.amazonaws.com/gtfs_archive/2022/06/03/ClusterToLine.zip
      possible values for filename: `ClusterToLine.zip`, `Tariff.zip`, `TripIdToDate.zip`, `israel-public-transportation.zip`.
  tasks:
    - id: full-process
      config:
        type: api
        module: open_bus_gtfs_etl.full_process
        function: main
        kwargs:
          last_days: {}
          max_run_time_seconds: {}

- name: gtfs-etl-upload-to-s3
  description: |
    Manual trigger for uploading GTFS data to S3
  docs:
    hide: true
  tasks:
    - id: upload_to_s3
      config:
        type: cli
        module: open_bus_gtfs_etl.cli
        function: upload_to_s3
        kwargs:
          date: {}
          force: {}
          upload_all: {}

- name: gtfs-etl-load-missing-data
  description: |
    Manual trigger for loading missing data to the DB
    {"from_date": "2022-03-19", "to_date": "2022-03-15"}
  docs:
    hide: true
  tasks:
    - id: load_missing_data
      config:
        type: api
        module: open_bus_gtfs_etl.load_missing_data
        function: main
        kwargs:
          from_date: {}
          to_date: {}
